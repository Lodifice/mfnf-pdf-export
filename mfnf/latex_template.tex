\documentclass[fontsize=9pt,
               paper=155mm:235mm,
               parskip=half-,
               BCOR=5mm,DIV=15]{scrbook}

% set font size to 9pt and base line height to 12pt
\changefontsizes[12pt]{9pt}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[ngerman]{babel}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{cancel}
\usepackage{booktabs}
\usepackage[space]{grffile}
\usepackage{verbatim}
\usepackage{changepage}
\usepackage{marvosym}
\usepackage{multicol}
\usepackage[dvipsnames]{xcolor}
\usepackage[hidelinks,breaklinks]{hyperref}
\usepackage{subcaption}
\usepackage{float}
\usepackage[normalem]{ulem}
\usepackage{csquotes}
\usepackage[framemethod=default]{mdframed}
\usepackage{tocloft}
\usepackage[toc]{multitoc}
\usepackage{enumitem}

% allow max height and max width for image includes
\usepackage[Export]{adjustbox}

% show overfull boxes
\overfullrule=1mm

% Redefine \rm for math environment -> raises an error otherwise
% TODO: Is there a better solution
\renewcommand*{\rm}[1]{\mathrm{#1}}

\usepackage{fontspec}
\setmainfont[Ligatures=TeX,
             Extension=.ttf,
             BoldFont=Karmilla-Bold-016m,
             ItalicFont=Karmilla-Italic-016m,
             Path=../../karmilla/ttf/]{Karmilla-Regular-016m}
% fallback font or unicode (like smileys)
\newfontfamily\DejaSans{DejaVu Sans}
% font for box icons
\newfontfamily\FontAwesome[Path=../../Font-Awesome/fonts/,
                           Extension=.ttf]{fontawesome-webfont}
\newlength{\lineheight}
\makeatletter\setlength{\lineheight}{\f@size pt}\makeatother

\allowdisplaybreaks[4]
\predisplaypenalty=0

\definecolor{sblau}{HTML}{007ec1}
\colorlet{shellblau}{sblau!30}
\definecolor{forestgreen}{rgb}{0.13, 0.55, 0.13}

% change font and color of headers and table of contents
\addtokomafont{disposition}{\rmfamily\color{sblau}}
% change font of descriptionlabels
\addtokomafont{descriptionlabel}{\rmfamily}

\errorcontextlines 10000

\mdfdefinestyle{semanticbox}{innerleftmargin=5.5pt,
                             innerrightmargin=0pt,
                             innertopmargin=0pt,
                             innerbottommargin=0pt,
                             skipabove=\baselineskip,
                             linecolor=shellblau,
                             linewidth=5.5pt,
                             topline=false,
                             rightline=false,
                             bottomline=false,
                             theoremseparator=\\,
                             frametitlefont=\normalfont,
                             theoremtitlefont={\normalfont\bfseries\color{sblau}},
                             frametitleaboveskip=0pt,
                             frametitlebelowskip=\baselineskip}

\mdfdefinestyle{importantbox}{innerleftmargin=5.5pt,
                              innerrightmargin=0pt,
                              innertopmargin=0pt,
                              innerbottommargin=0pt,
                              skipabove=\baselineskip,
                              linecolor=shellblau,
                              linewidth=5.5pt,
                              topline=false,
                              rightline=false,
                              bottomline=false,
                              fontcolor=sblau}

\def\IconHeight{30px}

\newmdenv[style=importantbox]{importantparagraph*}
\newenvironment{indentblock}{\begin{adjustwidth}{.5cm}{}}{\end{adjustwidth}}

\newcommand{\BoxIcon}[1]{\rlap{\protect\makebox[-\IconHeight]{\raisebox{-30px}[0pt][0pt]{\includegraphics[height=\IconHeight]{../../icons/#1.png}}}}}
\def\IcProof{}
\newcommand{\BoxFont}[1]{\rlap{\protect\makebox[-2.0cm]{\smash{\color{shellblau}\huge\FontAwesome #1}}}}

\mdtheorem[style=semanticbox,
           startcode=\BoxIcon{theorem}]{theorem}{Satz}[chapter]

\mdtheorem[style=semanticbox]{definition}{Definition}[chapter]
\mdtheorem[style=semanticbox]{exercise}{Übung}[chapter]
\mdtheorem[style=semanticbox]{solution}{Lösung}[chapter]
\mdtheorem[style=semanticbox]{alternativeproof}{Alternativer Beweis}[chapter]
\mdtheorem[style=semanticbox]{warning}{Warnung}[chapter]
\mdtheorem[style=semanticbox]{hint}{Hinweis}[chapter]
\mdtheorem[style=semanticbox]{explanation}{Erklärung}[chapter]
\mdtheorem[style=semanticbox]{proofsummary}{Beweiszusammenfassung}[chapter]
\mdtheorem[style=semanticbox]{solutionprocess}{Lösungsweg}[chapter]
\mdtheorem[style=semanticbox]{example}{Beispiel}[chapter]
\mdtheorem[style=semanticbox]{answer}{Antwort}[chapter]
\mdtheorem[style=semanticbox]{induction}{Induktionsbeweis}[chapter]

\makeatletter
\let\proof\@undefined
\let\endproof\@undefined
\makeatother
\mdtheorem[style=semanticbox,startinnercode=\BoxFont{\IcProof}]{proof}{Beweis}[chapter]

\newcommand{\ColoredTOC}{{\twocolumn\color{sblau}\tableofcontents\onecolumn}}
\setlength{\columnseprule}{0.25pt}
\setlength{\columnsep}{1cm}
\renewcommand{\columnseprulecolor}{\color{sblau}}
\setcounter{tocdepth}{1}
\cftpagenumbersoff{part}

\setlist{leftmargin=11pt,labelindent=0pt,font=\color{sblau}}

\newcommand{\proofstep}[1]{\textbf{\textcolor{sblau}{#1}}}
\newcommand{\proofcase}[2]{\textbf{\textcolor{sblau}{Fall #1:}} #2}
\newcommand{\inductionstep}[2]{\textbf{\textcolor{sblau}{#1.}} #2}

% no additional space around equations is needed since they are always in their own paragraph
% see https://tex.stackexchange.com/a/69665
\expandafter\def\expandafter\normalsize\expandafter{%
\normalsize
\abovedisplayskip=-\baselineskip % if a paragraph starts with an equation then a blank extra line appears
\abovedisplayshortskip=-\baselineskip
\belowdisplayskip=0pt
\belowdisplayshortskip=0pt
}

