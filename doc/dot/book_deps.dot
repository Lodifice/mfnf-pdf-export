digraph book_dependencies {
    compound=true;
    // enable new ranking algorithm
    newrank=true;
    ranksep=.4;

    sitemap_article [label="sitemap article\nsource (.md)"];
    sitemap_intermediate [label="sitemap intermediate\nrepresentation (.yml)"];
    sitemap_parsed [label="machine readable\nsitemap (.sitemap.parsed.yml)"];
    sitemap [label="sitemap (.sitemap.yml)"];
    book_deps [label="book dependency file (.book.dep)", shape=box];
    book_dependencies [label="book dependencies (.book.dependencies)"];
    book_anchors [label="book anchors (.anchors)"];
    the_markers [label="article marker\n(.markers)"];
    article_deps [label="other article dependencies\n(article source, sections, media, ...)"];
    result [label="book export result\n(.book.tex, .book.html, ...)"];

    sitemap_article -> sitemap_intermediate -> sitemap_parsed -> sitemap; 
    sitemap -> book_deps;
    book_deps -> book_dependencies [label="defines", style=dotted];
    the_articles -> book_dependencies;
    the_anchors -> book_anchors -> the_articles;
    sitemap -> book_anchors;
    sitemap -> the_markers;
    the_markers -> the_anchors [lhead=cluster_articles];
    article_deps -> the_anchors [lhead=cluster_articles];
    book_dependencies -> result;
    
    subgraph cluster_articles {
        the_anchors [label="article reference anchors\n(.anchors)"];
        the_articles [label="exported articles\n(.tex, .raw_html, .stats.yml)"];
       
        the_anchors -> the_articles;
    }
}
